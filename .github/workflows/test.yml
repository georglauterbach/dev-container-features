name: Testing

on:
  workflow_dispatch:
  pull_request:
  # push:
  #   branches: [ main ]

jobs:
  test-autogenerated:
    name: Test Auto-Generated
    runs-on: ubuntu-24.04
    strategy:
      matrix:
        baseImage:
          - debian:latest
          - ubuntu:latest
          - mcr.microsoft.com/devcontainers/base:ubuntu
          - ghcr.io/georglauterbach/dev-container-base:latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install latest devcontainer CLI
        run: npm install -g @devcontainers/cli

      - name: Generating tests against '${{ matrix.baseImage }}'
        run: devcontainer features test -f rust -i ${{ matrix.baseImage }} --skip-scenarios .

  test-local-scenarios:
    name: Test Local Scenarios
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install latest devcontainer CLI
        run: npm install -g @devcontainers/cli

      - name: Generating tests scenarios
        run: devcontainer features test -f rust --skip-autogenerated --skip-duplicated .

  test-global-scenarios:
    name: Test Global Scenarios
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install latest devcontainer CLI
        run: npm install -g @devcontainers/cli

      - name: Testing global scenarios
        run: devcontainer features test --global-scenarios-only .
